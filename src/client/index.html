<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Issues Viewer</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Linear Issues Viewer</h1>
            <p>Enter your Linear API token to view your issues</p>
        </header>

        <div class="token-section" id="token-section">
            <div class="input-group">
                <label for="token-input">Linear API Token:</label>
                <input
                    type="password"
                    id="token-input"
                    placeholder="Enter your Linear API token"
                    autocomplete="off"
                >
                <button id="fetch-button" onclick="fetchIssues()">Fetch Issues</button>
            </div>
            <div class="help-text">
                <p>
                    <strong>How to get your Linear API token:</strong><br>
                    1. Go to <a href="https://linear.app/settings/api" target="_blank">Linear Settings â†’ API</a><br>
                    2. Click "Create API key"<br>
                    3. Give it a name and copy the generated token
                </p>
            </div>
        </div>

        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Fetching issues...</p>
        </div>

        <div id="error-message" class="error hidden" style="display: none !important;"></div>

        <div id="results-section" class="results-section hidden">
            <!-- Tab Navigation with Filters -->
            <div class="tab-navigation">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTab('table', event)">Table View</button>
                    <button class="tab-button" onclick="switchTab('interactive-mindmap', event)">Interactive Mind Map</button>
                </div>
                <div class="filter-widgets">
                    <div class="filter-group">
                        <label>Status:</label>
                        <div class="multi-select-dropdown" id="status-filter">
                            <div class="multi-select-button" onclick="toggleDropdown('status-filter')">
                                <span class="selected-text">All Statuses</span>
                                <span class="dropdown-arrow">â–¼</span>
                            </div>
                            <div class="multi-select-options" style="display: none;">
                                <div class="option-item select-all">
                                    <input type="checkbox" id="status-select-all" onchange="toggleSelectAll('status')">
                                    <label for="status-select-all">Select All</label>
                                </div>
                                <div class="options-divider"></div>
                                <div class="options-list" id="status-options-list">
                                    <!-- Options will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Assignee:</label>
                        <div class="multi-select-dropdown" id="assignee-filter">
                            <div class="multi-select-button" onclick="toggleDropdown('assignee-filter')">
                                <span class="selected-text">All Assignees</span>
                                <span class="dropdown-arrow">â–¼</span>
                            </div>
                            <div class="multi-select-options" style="display: none;">
                                <div class="option-item select-all">
                                    <input type="checkbox" id="assignee-select-all" onchange="toggleSelectAll('assignee')">
                                    <label for="assignee-select-all">Select All</label>
                                </div>
                                <div class="options-divider"></div>
                                <div class="options-list" id="assignee-options-list">
                                    <!-- Options will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label for="search-input">Search:</label>
                        <div class="search-input-container">
                            <input type="text" id="search-input" placeholder="Search issue names..." oninput="handleSearchInput()" onkeypress="handleSearchKeypress(event)">
                            <button type="button" id="search-clear" class="search-clear-btn" onclick="clearSearch()" title="Clear search">&times;</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <button id="refresh-button" class="refresh-btn" onclick="refreshIssues()" title="Refresh data from Linear">
                            <span class="refresh-icon">ðŸ”„</span>
                            <span class="refresh-text">Refresh</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Table View -->
            <div id="table-view" class="tab-content active">
                <div class="table-container">
                    <table id="issues-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Assignee</th>
                                <th>Team</th>
                                <th>Created</th>
                                <th>Updated</th>
                            </tr>
                        </thead>
                        <tbody id="issues-tbody">
                        </tbody>
                    </table>
                </div>
            </div>



            <!-- Interactive Mind Map View -->
            <div id="interactive-mindmap-view" class="tab-content">
                <div class="mindmap-instructions collapsed">
                    <div class="instructions-header" onclick="toggleInstructions()">
                        <span class="instructions-title"><strong>Instructions</strong></span>
                        <span class="instructions-toggle">â–¶</span>
                    </div>
                    <div class="instructions-content">
                        <ul>
                            <li>Double-click nodes to edit</li>
                            <li>Drag nodes to reposition</li>
                            <li>Right-click nodes to add children or delete</li>
                            <li>Press Tab to create new issues</li>
                            <li>Press Delete to remove selected nodes</li>
                        </ul>
                    </div>
                </div>
                <div id="interactive-mindmap-container"></div>
            </div>
        </div>
    </div>

    <!-- Issue Dialog Modal -->
    <div id="issue-dialog" class="dialog-overlay hidden">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3>Issue Details</h3>
                <span id="issue-id-display" class="issue-id"></span>
                <button class="dialog-close" onclick="closeIssueDialog()">&times;</button>
            </div>
            <div class="dialog-body">
                <div class="form-group">
                    <label for="issue-name">Name:</label>
                    <input type="text" id="issue-name" placeholder="Issue name">
                </div>
                <div class="form-group">
                    <label for="issue-description">Description:</label>
                    <textarea id="issue-description" rows="4" placeholder="Detailed description of the issue"></textarea>
                </div>
                <div class="form-group">
                    <label for="issue-status">Status:</label>
                    <select id="issue-status">
                        <option value="backlog">Backlog</option>
                        <option value="in-progress">In Progress</option>
                        <option value="done">Done</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="issue-assignee">Assignee:</label>
                    <input type="text" id="issue-assignee" placeholder="Enter assignee name or email">
                    <small class="field-help">Note: Assignee changes are saved locally only. Linear API assignee updates are not yet implemented.</small>
                </div>
                <div class="form-group project-info-section">
                    <label>ðŸ“‹ Project Information (Read-only):</label>
                    <div class="project-info-grid">
                        <div class="project-info-item">
                            <label for="issue-team">Team:</label>
                            <input type="text" id="issue-team" disabled class="readonly-field">
                        </div>
                        <div class="project-info-item">
                            <label for="issue-team-id">Team ID:</label>
                            <input type="text" id="issue-team-id" disabled class="readonly-field">
                        </div>
                        <div class="project-info-item">
                            <label for="issue-project">Project:</label>
                            <input type="text" id="issue-project" disabled class="readonly-field">
                        </div>
                        <div class="project-info-item">
                            <label for="issue-project-id">Project ID:</label>
                            <input type="text" id="issue-project-id" disabled class="readonly-field">
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeIssueDialog()">Cancel</button>
                <button class="btn btn-primary" onclick="saveIssueDialog()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu hidden">
        <div class="context-menu-item" onclick="createChildNode()">Add Child Issue</div>
        <div class="context-menu-item" onclick="editContextNode()">Edit Issue</div>
        <div class="context-menu-item delete-item" onclick="deleteContextNode()">Delete Issue</div>
    </div>

    <script src="https://unpkg.com/d3@5/dist/d3.min.js"></script>
    <script src="js/utils/api.js"></script>
    <script src="js/components/mindmap/mindmap-utils.js"></script>
    <script src="js/components/mindmap/mindmap-d3.js"></script>
    <script src="js/components/dialogs/issue-dialog.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
